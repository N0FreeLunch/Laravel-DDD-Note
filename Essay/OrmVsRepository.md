## ORM과 레포지토리

### 컴파일 언어와 인터프리터 언어

최근의 웹은 바퀴를 새로 만들지 않기 위해서 웹 프레임워크라는 툴을 이용해 개발한다. 인터프리터 언어가 무언가를 개발하고 실행을 할 때, 웹 프레임워크를 기동해서 어떤 기능의 동작을 확인하기 쉽지만, 컴파일언어는 작성된 코드의 실행을 확인하기 위해 프레임워크를 기동하기 위해서는 작성한 코드와 더불어 프레임워크의 코드도 함께 컴파일을 해야 하므로 동작을 확인하는데 더 오랜 시간이 소요된다.

### 고전파와 런던파

프로그래밍에서 테스트 코드를 작성하는 방법은 크게 두 가지 방식으로 이뤄지는데, 실제 환경과 최대한 유사한 환경에서 코드의 동작을 체크하는 고전파의 테스트 방식으로 불리는 것이 있고, 실제 환경과 유사한 모의 환경에서 직접 데이터를 받아 오지 않고, 객체나 함수가 마치 데이터를 받아 온 것 처럼 가짜 값을 멤버에 저장하거나 반환 값으로 전달하도록 만드는 런던파의 테스트 방식이 있다.

### 고전파의 테스트 방식

실제 환경과 최대한 동일한 환경에서 테스트 코드를 동작시키기 위해서는 작성한 코드 뿐만 아니라, 사용하고 있는 라이브러리와 프레임워크의 코드도 함께 실행해야 한다. 어떤 코드를 작성하고 코드의 동작을 실행하기 위해서 프레임워크와 작성된 코드를 모두 빌드하는 것은 많은 시간이 걸린다. 실제 코드를 개발할 때는 동작을 확인하는 과정이 반복되는데 코드의 실행 시간에 수십초의 시간이 걸리게 되면 그 만큼 생산성이 떨어지게 된다.

고전파의 테스트 방식은 컴파일 언어 보다는 인터프리터 언어를 사용할 때 적절하며, 작성한 코드를 전체 프레임워크가 실행된 상태인 실제 프로덕션 서버의 애플리케이션이 동작하는 코드가 그대로 동작하므로 태스트 코드를 실행할 때 실제 환경과 개발 환경의 차이가 적다는 장점이 있다.

### 런던파의 테스트 방식

모든 코드를 작성하고 실행해서 확인하는 것 보다는, 조금씩 코드를 작성하고 그 결과를 확인해 나가면서 코딩을 하는 것이 일반적이다. 사람은 컴퓨터가 실행하는 모든 코드의 동작을 한 번에 파악하기 어렵고, 프로그래밍 로직의 전개 과정을 놓치는 경우도 있기 때문에 조금씩 코드를 짜고 그 실행 결과가 자신이 의도한 결과를 도출하는지 확인하는 과정이 필요하다. 그렇지 않았을 때 문제가 발생한다면, 어떤 부분에서 문제가 발생했는지 확인하기 어려운 경우가 생길 때가 있다.

컴파일 언어의 경우 조금 작성한 코드의 실행을 확인하기 위해 프레임워크를 포함하는 애플리케이션 전체의 코드를 빌드하는 것은 빌드 시간이 소요되므로 조금 작성한 코드를 계속해서 확인하면서 개발하기 어렵다. IDE에 의존하여 어느 정도의 코드를 만들고 이를 실행하는 방식으로 코드를 작성하는 것을 통해서 점점 더 큰 코드를 작성할 수 있다. 하지만 php와 같은 동적언어는 IDE의 추론이 일어나지 않는 코드도 많고, 화면을 직접 보고 개발해야 하는 경우 화면의 동작이 잘 이뤄지는지 짧은 주기로 확인하는 편이 좋다. 어떤 식으로든 짧은 주기로 작성한 코드를 확인하는 것은 코드 개발에 상당히 유익하다.

빠른 피드벡을 통한 코드의 실행을 확인하기 위해서 컴파일 언어의 경우 조금 작성한 코드의 실행을 확인하기 위해 전체 애플리케이션을 빌드해서 실행하는 것이 아니라, 다른 부분에 의존적인 부분 (프레임워크 또는 외부 데이터에 의존하는 데이터)을 모의하는 것을 통해서 애플리케이션 전체를 빌드하지 않고, 일부만 빌드하여 빠르게 빌드하고 코드의 결과를 확인한다. 컴파일 언어를 사용한 개발에서 특히 TDD는 중요하게 다뤄지는데, 전체적인 기능을 작성하기 전에 로직의 일부만 작성했을 때 그 동작을 확인하는 빠른 피드벡 루프를 사용할 수 있기 때문이다.

### 테스트 가능한 코드 (Testable code)

테스트라는 것은 어떤 인풋 값에 대해 기대할 수 있는 어떤 결과를 얻어 낼 수 있을 때 테스트 가능하다고 한다. 인풋을 어떻게 주었을 때 기대되는 결과는 무엇이다. 이것이 명확해야 테스트를 할 수 있는 코드가 된다.

모든 코드를 테스트 할 수 있는 것이 아니다. 인풋과 아웃풋의 관계가 명확한 코드만 테스트 할 수 있다. 작은 단위의 코드를 테스트하기 위해서는 작은 단위로 인풋에 대한 아웃풋을 확인할 수 있는 코드를 작성해야 한다. 작은 단위의 코드를 작성할 때도 테스트가 가능한 코드를 만들기 위해서는 무엇이 인풋이고 이에 대한 아웃풋은 무엇인지 그 관계를 명확하게 만들어야 테스트가 가능하다.

웹 애플리케이션의 테스트에서 고전파의 테스트 방식으로는 http 리퀘스트를 전달했을 때, http 리스폰스와 데이터베이스의 변경을 확인하면 충분한 경우가 많지만, 애플리케이션을 모두 빌드해서 실행할 수 없는 컴파일 언어의 경우에는 작은 단위로 테스트 가능한 코드를 만들어야 한다.

### 레포지토리 패턴

도메인 주도 설계에서 전술적 패턴은 코딩의 패턴에 대해 알려 준다. 레포지토리 클래스, 엔터티 클래스, DTO 클래스, VO 클래스를 만들고 이들을 사용하여 로직을 구성한다. 특히 레포지토리 패턴은 데이터베이스의 데이터를 가져와서 데이터를 객체 또는 데이터 구조에 담아내는 역할을 한다.

레포지토리의 메소드는 하나의 메소드를 사용하면 데이터베이스에서 데이터를 가져와 객체에 메핑을 할 수 있는 데이터를 담은 객체 또는 객체를 담은 데이터 구조를 제공한다. 이런 레포지토리 패턴은 메소드의 조합으로 다양한 양상이 나오는 것이 아니기 때문에 메소드가 반환할 데이터 객체를 쉽게 모의할 수 있다. 데이터베이스라는 외부 환경에 의존하지 않고, 메소드의 행위를 모의하는 것을 통해서 데이터베이스를 직접 사용하지 않는 코드를 작성할 수 있다.
