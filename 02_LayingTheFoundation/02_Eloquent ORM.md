## Eloquent ORM
- 라라벨에서 도메인 중심 디자인을 개발하는 데 가장 중요한 도구 중 하나는 Eloquent이다.

### DDD와 ORM
- 데이터 질의어(Data Definition Language)를 코드를 작성할 때 직접 사용하는 것은 도메인 주도 설계의 내부 관행과 가치에 맞지 않는다. 왜냐하면 DDD는 불가지론적인 방법인데 데이터 정의어를 직접 사용하는 것은 특정 DB등에 종속되는 것이기 때문이다.
- 다양한 데이터베이스에 대한 데이터 조작을 동일한 방식으로 할 수 있는 엑티브 레코드 곧 ORM을 사용하는 것은 디비의 질의어에 종속되지 않기 때문에 DDD에 적합하다.
- 디비 등의 저장소의 데이터를 조작해야 하는 도메인의 이벤트를 허용한다.

### ORM의 장점
- 모델 간의 관계를 생성 및 관리가 편리하다.
- 모델의 생성 및 관리를 편리하게 하여 복잡한 질의어가 아닌 간단한 표현적인 구문을 사용하여 쿼리 처리를 할 수 있다.
- ORM은 데이터를 가져와서 객체에 저장을 하고 있다. 모델을 통해서 업데이트 작업이 일어나면 객체에 데이터를 다시 저장하는 로직이 필요하다. 이러한 작업을 ORM이 자동으로 해 준다.

### Eloquent ORM의 특성
- 대량 할당 (messive assignment)
- 쿼리 스코프
- Eager loading
- 컬렉션
- 모델 이벤트
- 모델 옵저버
- 모델이 유효하고 일관된 상태인지 체크
- 잘못된 사용을 방지하기 위해 적절한 제한이 있는지 확인하는 유효성 검사 구성 요소가 존재

### 객체
- 기본적으로 클래스에는 멤버 변수와 멤버 메소드가 존재한다. 멤버 변수는 객체의 상태를 저장하는 부분이며, 멤버 메서드는 객체의 상태를 변경하기 위한 조작 기능을 정의한 곳이다.
- 기본적으로 객체는 데이터를 저장하는 부분과 데이터의 변경하는 기능을 동시에 가지고 있다. 하지만 현재 프로그래밍에서는 객체의 데이터와 동작을 분리하는 방식을 고안하는 경향이 커졌다.
- 기본적으로는 객체의 멤버를 다루기 위한 getter와 setter가 존재하는 객체로 이해를 한다.

### DTO
- 기본적인 객체의 특성을 가지고 있으면서 데이터를 객체에 매핑한 객체이다. 
- 단순 매핑의 기능을 담당하는 개념을 가진 대상이기 때문에 디비의 데이터를 저장하고 읽고 변경하는 로직만 존재한다.
- Data Transfer Object라고 부르는데 데이터의 CURD를 다루를 객체를 의미한다. 보통은 디비의 데이터를 객체로 다루기 위한 방식이다.
- 다량의 쿼리 요청을 방지하기 위해서 영속성 계층(영속성 계층 : 데이터 베이스 등 영구적으로 데이터가 저장되는 계층)에서 데이터를 한 번만 가져와서 저장한 데이터에 대한 getter, setter 등의 동작을 제공한다.
- 데이터는 멤버 변수에 매핑이 되어 있으며, 데이터를 가져올 때는 getter를 통해서 디비의 데이터를 가져오며, 데이터를 변경할 때는 setter를 통해서 디비의 데이터를 조작한다.
- 어떤 객체에 직접적인 쿼리나 쿼리 빌더 등을 통해서 데이터를 가져오는 getter를 만들 수도 있고, 데이터를 수정하는 setter를 만들 수도 있다. 데이터를 한 번 가져와서 저장하기 때문에 보통은 생성자에 데이터를 가져오는 로직을 만든다.
- DTO 객체는 영속성 계층(데이터 베이스 등 영구적으로 데이터가 저장되는 계층)에서 데이터를 가져와서 멤버에 저장하는 방식으로 사용되므로 단순 쿼리를 사용하게 좋게 모듈화한 인터페이스는 아니다.

#### DTO 계층을 만드는 이유
- 한번 가져온 데이터를 여러 번의 엑세스를 하는 경우, 매번 쿼리를 사용하여 가져올 필요가 없다. 영속성 계층의 데이터의 변경이 일어나기 전까지는 한번 데이터를 가져와서 저장한 객체에 접근하여 데이터를 가져오면 훨씬 효율적이다.
- 하지만 데이터의 변경이 이뤄지는 경우 이를 감지하여 DTO의 데이터를 리프레시 해 줘야 한다. 라라벨의 Eloquent ORM은 모델 옵저버 기능을 활용해 데이터의 변경이 일어났을 경우, ORM의 데이터를 변경해 주는 기능을 가지고 있다.

#### 라라벨에서의 DTO
- 라라벨의 Eloquent ORM은 완벽한 DTO가 아니다. 디비의 데이터를 가져오기 위한 제약 및 관계를 만들기 위한 기능 등 실용적인 쓰임을 위해서 만든 객체이다.
- ORM에서 사용할 수 없는 쿼리의 세부적인 컨트롤 등을 위해서 ORM과 영속성 계층 사이 DTO를 정의하여 쿼리를 세부적으로 컨트롤 하는 인터페이스를 제공하는 객체를 만들 수 있다. 하지만 대개의 경우, ORM이 제공하는 기능을 활용해서 편리하게 레포지토리 인터페이스를 만들 수 있기 때문에 DTO 계층을 따로 만들 필요는 없다.


### Eloquent 모델의 예
```
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Model;
class Custormer extends Model
{
  public $table = 'customers';
  protected $fillable = ['name', 'phone', 'phone_type'];
}
```
