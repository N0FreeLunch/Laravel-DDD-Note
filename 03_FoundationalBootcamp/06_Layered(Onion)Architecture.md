

```
------------------------------------
|        application layer         |
|   |--------------------------|   |
|   |   infrastructure layer   |   |
|   |  ----------------------  |   |
|   |  |    domain layer    |  |   |
|   |  ----------------------  |   |
|   |--------------------------|   |
------------------------------------
```
- 애플리케이션 레이어 안에 인프라스트럭처 레이어가 존재할 수 있도록 만들고 인프라스트럭처 레이어 안에 도메인 레이어가 존재할 수 있도록 만들어야 한다.
- 애플리케이션 레이어에 대하여 인프라스트럭처 레이어가 캡슐화 되어 있는 것을 알 수 있으며, 인프라스트럭처 레이어에 대해 도메인 레이어가 캡슐화 되어 있다는 것을 알 수 있다.
- 상위 계층 -> 하위 계층 순 : application layer -> infrastructure layer -> domain layer관계이며 상위 계층은 하위 계층에 의존적이다. 

### 계층적 구조에서 모델의 배치
- MVC 모델에서 V(view)를 상위 C(controller)를 중간 M(model)을 하위로 볼 수 있다.
- 도메인 모델을 구축하면서도 모델을 하위 단계로 향하도록 만드는데 이는 데이터 모델을 비즈니스 모델과 분리하기 위한 방식이다.


## 클라이언트
- 어떤 프로그래밍적인 구현이 외부에 인터페이스를 제공할 때, 해당 인터페이스를 활용하는 대상이 클라이언트이다.
- 클라이언트는 ‘클라이언트 – 서버’라는 관계로 보통 설명되지만 인터페이스를 제공할 수 있는 모든 구현을 어떻게든 이용하는 관계로 설명이 되면 클라이언트라고 설명 될 수 있다.

## 계층
### 애플리케이션 계층
- 클라이언트가 HTTP, API, SOAP등의 호출을 통해서 어떤 구현의 인터페이스를 이용할 경우 이를 애플리케이션이라고 보통 말한다.
- 애플리케이션의 클라이언트는 프로그램 사용자이다. 이 유저는 애플리케이션 계층의 인터페이스를 사용한다.
- 비즈니스 규칙이나 비즈니스 앤터티에 대한 직접적인 처리를 하는 기능을 포함하지 않는다. 이 구현은 도메인 계층에게 맡긴다.
- 애플리케이션 계층은 인프라 계층의 인터페이스를 사용하여 인프라계층이 제공하는 기능을 다룬다.
- 인프라계층은 도메인 계층이 제공하는 인터페이스를 이용해서 도메인 계층이 제공하는 기능을 다루며, 애플리케이션 계층이 인프라 계층을 다루지만, 애플리케이션 인프라 계층에서 도메인 계층을 어떻게 다루고 있는지는 알 필요까지는 없다.

### 애플리케이션 계층에서 담당하는 작업의 예
- 영속성 계층의 트렌젝션 및 보안을 제어(벨리데이션과 같은 기능)한다.
- 이메일과 같은 직접 외부 통신을 하는 기능을 작성
- 이벤트를 제어하고 이벤트에 의한 알람을 다른 시스템으로 보낸다.
- 도메인 계층에서 발생하는 이벤트를 구독한다.
- 애플리케이션 계층은 도메인 모델의 직접적인 클라이언트이다.(? 이건 인프라 계층이 아닌가?)

## 인프라 계층의 예
- 도메인 계층의 인터페이스를 다룬다.
- 리포지토리 계층을 담는 부분이다.
- 의존성 주입을 이용하여 IOC를 구현한다. IOC를 구현하게 되면 인프라 계층 아래 계층에 인터페이스를 제공할 수 있다.
- 펙토리 패턴을 사용하는 계층이다. (도메인 계층도 펙토리 패턴을 사용한다.
- 영속성 매커니즘(의도를 잘 모르겠음)

## 제어의 역전 IOC
- 도메인 계층이 인프라 계층에 인터페이스를 제공하고 인프라 계층이 어플리케이션 계층에 인터페이스를 제공하고 어플리케이션 계층이 유저 클라이언트 쪽에 인터페이스를 제공하는데 이 관계가 역전되어 인프라 계층이 도메인 계층에게 인터페이스를 제공할 수 있게 되는 현상을 의미한다.

## 도메인레이어 (+ 모델 레이어)
- 비즈니스 규칙 및 엔터티가 포함 됨
- 비즈니스 로직을 작성하는 부분으로 도메인과 관련된 프로세스 및 작업 처리를 담당한다.
- 도메인레이어의 클라이언트는 응용 프로그램 계층에 존재 
- 비즈니스의 컨텍스트와 비즈니스 구성요소의 분리가 핵심이다. 분리된 구성요소들로 이뤄진 비즈니스 로직을 구성하는 것이 비즈니스 컨텍스트를 이루는 것
- 모델 레이어는 애플리케이션에서 가장 중요한 레이어이다. 왜냐하면 영속성 데이터의 입출력 및 변경을 다루기 때문
- 애플리케이션에 존재하는 모델 레이어 이외의 레이어는 모델 레이어를 잘 다루기 위한 방법으로 존재하는 것이다.
- 도메인 계층의 개선은 개발자와 도메인 전문가 사이에서 비즈니스가 어떻게 작동하고 기능하는지에 대해 오래 논의 한 이후 이뤄져야 한다.
