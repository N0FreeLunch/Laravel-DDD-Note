# 레이어 아키텍처

```
------------------------------------
|        application layer         |
|   |--------------------------|   |
|   |   infrastructure layer   |   |
|   |  ----------------------  |   |
|   |  |    domain layer    |  |   |
|   |  ----------------------  |   |
|   |--------------------------|   |
------------------------------------
```
- 애플리케이션 레이어 안에 인프라스트럭처 레이어가 존재할 수 있도록 만들고 인프라스트럭처 레이어 안에 도메인 레이어가 존재할 수 있도록 만들어야 한다.
- 애플리케이션 레이어에 대하여 인프라스트럭처 레이어가 캡슐화 되어 있는 것을 알 수 있으며, 인프라스트럭처 레이어에 대해 도메인 레이어가 캡슐화 되어 있다는 것을 알 수 있다.
- 상위 계층 -> 하위 계층 순 : application layer -> infrastructure layer -> domain layer관계이며 상위 계층은 하위 계층에 의존적이다. 

### 계층적 구조에서 모델의 배치
- MVC 모델에서 V(view)를 상위 C(controller)를 중간 M(model)을 하위로 볼 수 있다.
- 도메인 모델을 구축하면서도 모델을 하위 단계로 향하도록 만드는데 이는 데이터 모델을 비즈니스 모델과 분리하기 위한 방식이다.

## 모듈과 캡슐화
- 모듈은 분할의 단위이다. 이 단위는 기능적인 단위 또는 의미론적 단위에 해당한다. 어떤 의미를 부여해서 모듈을 나누느냐 또는 어떤 기능을 담당하게 해서 모듈을 나누느냐를 생각할 수 있다.
- 예를 들어 기업에는 여러 부서가 존재한다. 부서들의 협동으로 이익을 창출 해 내는데 각 부서는 담당하는 역할이 있다.
- 기업은 각 부서에 어떤 일을 담당해 달라고 말한다. 여러 부서가 각 부서가 맡은 역할을 담당하면 기업의 이익 창출 활동이 이뤄진다. 각 부서에게 어떤 미션을 맡기지만 각 부서는 맡겨진 미션만 이뤄내면 될 뿐, 부서 내에서 누구에게 무엇을 맡기고 일처리를 어떻게 하는지는 기업 전체를 관리하는 입장에서는 생각하지 않아도 되도록 만드는 것이 중요하다. 
- 기업 경영자의 입장에서는 각 부서의 특성에 맡는 미션을 수행하는 것이 인터페이스이고 각 부서의 내부적인 활동은 경영자에게 굳이 보고할 필요가 없다. 이것이 캡슐화이다. 외부에는 특정 미션을 수행하기 위한 인터페이스를 제공하고 외부에 굳이 제공할 필요가 없는 내부 로직은 외부에 제공하지 않고 내부에서 알아서 동작하도록 만드는 것이 캡슐화이다.
- 부서 단위 뿐만 아니라 부품 부서라면 A부품, B부품을 담당하는 영역이 존재하고 A부품과 B부품을 합쳐 하나의 제품을 만드는 것으로 예를 들 수 있다. 제품 단위 등의 다양한 리소스들에 대해 기능적인 단위 의미론적 단위로 구분할 수 있다. 이런 방식을 사용하면 기업-부서 관계 보다 훨씬 작은 단위로 분할을 할 수 있다. 모듈을 더 작게 나눌 수 있는 것이다. 
- 이런 분리의 방식이 도메인 모델을 구축하는 방식이다. 

## 클라이언트
- 어떤 프로그래밍적인 구현이 외부에 인터페이스를 제공할 때, 해당 인터페이스를 활용하는 대상이 클라이언트이다.
- 클라이언트는 ‘클라이언트 – 서버’라는 관계로 보통 설명되지만 인터페이스를 제공할 수 있는 모든 구현을 어떻게든 이용하는 관계로 설명이 되면 클라이언트라고 설명 될 수 있다.

## 계층
### 애플리케이션 계층
- 클라이언트가 HTTP, API, SOAP등의 호출을 통해서 어떤 구현의 인터페이스를 이용할 경우 이를 애플리케이션이라고 보통 말한다.
- 애플리케이션의 클라이언트는 프로그램 사용자이다. 이 유저는 애플리케이션 계층의 인터페이스를 사용한다.
- 비즈니스 규칙이나 비즈니스 앤터티에 대한 직접적인 처리를 하는 기능을 포함하지 않는다. 이 구현은 도메인 계층에게 맡긴다.
- 애플리케이션 계층은 인프라 계층의 인터페이스를 사용하여 인프라계층이 제공하는 기능을 다룬다.
- 인프라계층은 도메인 계층이 제공하는 인터페이스를 이용해서 도메인 계층이 제공하는 기능을 다루며, 애플리케이션 계층이 인프라 계층을 다루지만, 애플리케이션 인프라 계층에서 도메인 계층을 어떻게 다루고 있는지는 알 필요까지는 없다.

### 애플리케이션 계층에서 담당하는 작업의 예
- 영속성 계층의 트렌젝션 및 보안을 제어(벨리데이션과 같은 기능)한다.
- 이메일과 같은 직접 외부 통신을 하는 기능을 작성
- 이벤트를 제어하고 이벤트에 의한 알람을 다른 시스템으로 보낸다.
- 도메인 계층에서 발생하는 이벤트를 구독한다.
- 애플리케이션 계층은 도메인 모델의 직접적인 클라이언트이다.(? 이건 인프라 계층이 아닌가?)

## 인프라 계층의 예
- 도메인 계층의 인터페이스를 다룬다.
- 리포지토리 계층을 담는 부분이다.
- 의존성 주입을 이용하여 IOC를 구현한다. IOC를 구현하게 되면 인프라 계층 아래 계층에 인터페이스를 제공할 수 있다.
- 펙토리 패턴을 사용하는 계층이다. (도메인 계층도 펙토리 패턴을 사용한다.
- 영속성 매커니즘(의도를 잘 모르겠음)

## 제어의 역전 IOC
- 도메인 계층이 인프라 계층에 인터페이스를 제공하고 인프라 계층이 어플리케이션 계층에 인터페이스를 제공하고 어플리케이션 계층이 유저 클라이언트 쪽에 인터페이스를 제공하는데 이 관계가 역전되어 인프라 계층이 도메인 계층에게 인터페이스를 제공할 수 있게 되는 현상을 의미한다.

## 도메인레이어 (+ 모델 레이어)
### 엔터티
- 정보의 단위를 의미한다. 정보는 어떤 구분할 수 있는 속성들이 모여서 하나의 개념적인 단위를 창출한 것을 의미한다. 부품 A, 부품 B, 부품 C가 서로 모여 하나의 제품이 된다고 하자. 그럼 A, B, C는 부품의 속성이며 A, B, C가 서로 모여서 제품이란 단위를 형성을 할 때, 제품이 되면서 A, B, C가 가진 속성 이외의 추가적인 인터페이스를 제공하는 단위가 되는 것이 앤터티의 의미이다.
- 데이터베이스에서는 속성들의 집합이 하나의 레코드가 된다. 이 하나의 레코드가 앤터티를 의미한다고 한다.
- OOP에서는 멤버 변수와 멤버 메소드가 하나의 속성을 의미하고 하나의 객체의 멤버 변수와 멤버 메소드가 조합이 되면서 객체만의 어떤 특성을 가지는 것이 앤터티가 되는 것이다.
- 도메인 모델에서 앤터티는 하나의 객체를 의미할 수도 있지만, 모듈화 된 객체들이 모여서 하나의 비즈니스 모델을 형성하는 것을 엔터티라고 부를 수 있다.
- 도메인 모델에서 비즈니스 규칙을 나타낸 한 단위의 비즈니스 로직 또는 하나의 클래스/객체가 비즈니스 앤터티라고 할 수 있다.
- 속성과 속성의 조합으로 속성만으로는 표현할 수 없는 무언가 의미론적 단위를 창출해 내었을 때 이를 앤터티라고 할 수 있다.

### 모델레이어
- - 모델이란 개념은 어플리케이션 분야에 한정해서 사용을 한다고 해도 다양하게 사용되고 있다. 디비의 데이터 입출력에 관한 부분을 보통 MVC 모델에서의 M 모델이라고 말하지만, MVC라고 어플리케이션을 크게 3부분으로 나누는 방식도 모델이라고 부른다. 모델은 나누는 것을 의미한다. 아키텍처의 특성이 드러나게 보통은 나눈다. 영속성 계층에 대한 모델이라는 것은 MVC의 M에 해당하고 이 M은 데이터의 입출력을 작은 단위로 나눈 것을 의미한다. 특정 기본키에 해당하는 레코드를 테이블에서 지워라, 특정 기본키에 해당하는 레코드의 특정 값을 수정하라 이런 영속성 계층의 데이터를 조작하는 단위를 만드는 것이다. 도메인 모델이란 것은 도메인을 나눈다는 것을 의미한다. 비즈니스 규칙 또는 비즈니스 엔터티에 따라 모듈들을 만들어 나가는 것이 중요하다. 여기서의 모델 레이어라는 것은 도메인 레이어를 의미한다. 도메인 모델인 것이다. 

### 도메인레이어의 특징
- 비즈니스 규칙 및 엔터티가 포함 됨
- 비즈니스 로직을 작성하는 부분으로 도메인과 관련된 프로세스 및 작업 처리를 담당한다.
- 도메인레이어의 클라이언트는 응용 프로그램 계층에 존재 
- 비즈니스의 컨텍스트와 비즈니스 구성요소의 분리가 핵심이다. 분리된 구성요소들로 이뤄진 비즈니스 로직을 구성하는 것이 비즈니스 컨텍스트를 이루는 것
- 모델 레이어는 애플리케이션에서 가장 중요한 레이어이다. 왜냐하면 영속성 데이터의 입출력 및 변경을 다루기 때문
- 애플리케이션에 존재하는 모델 레이어 이외의 레이어는 모델 레이어를 잘 다루기 위한 방법으로 존재하는 것이다.
- 도메인 계층의 개선은 개발자와 도메인 전문가 사이에서 비즈니스가 어떻게 작동하고 기능하는지에 대해 오래 논의 한 이후 이뤄져야 한다.


